<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Optimized Meta Description for SEO -->
    <meta name="description" content="Boost your Agriculture exam prep with AgriQuiz! Attempt 407+ bilingual (English & Hindi) questions. Challenge your brain on Crops, Forestry & more for ICAR & IBPS AFO 2026.">
    <!-- Optimized Title Tag -->
    <title>AgriQuiz by ToolBlaster | 407+ Agriculture Exam Questions</title>
    
    <!-- Canonical Link (Prevents duplicate content issues) -->
    <link rel="canonical" href="https://agriquiz.toolblaster.com/">

    <!-- Open Graph / Facebook / LinkedIn -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://agriquiz.toolblaster.com/">
    <meta property="og:title" content="AgriQuiz by ToolBlaster | 407+ Agriculture Exam Questions">
    <meta property="og:description" content="Boost your Agriculture exam prep with AgriQuiz! Attempt 407+ bilingual (English & Hindi) questions. Challenge your brain on Crops, Forestry & more for ICAR & IBPS AFO 2026.">
    <!-- Updated to use the high-quality 512px favicon -->
    <meta property="og:image" content="https://agriquiz.toolblaster.com/favicon/web-app-manifest-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary"> <!-- Changed to summary since we are using a square icon -->
    <meta property="twitter:url" content="https://agriquiz.toolblaster.com/">
    <meta property="twitter:title" content="AgriQuiz by ToolBlaster | 407+ Agriculture Exam Questions">
    <meta property="twitter:description" content="Boost your Agriculture exam prep with AgriQuiz! Attempt 407+ bilingual (English & Hindi) questions. Challenge your brain on Crops, Forestry & more for ICAR & IBPS AFO 2026.">
    <!-- Updated to use the high-quality 512px favicon -->
    <meta property="twitter:image" content="https://agriquiz.toolblaster.com/favicon/web-app-manifest-512x512.png">

    <!-- JSON-LD Schema for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "AgriQuiz",
      "operatingSystem": "Web",
      "applicationCategory": "EducationalApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "ToolBlaster",
        "url": "https://toolblaster.com"
      }
    }
    </script>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://agriquiz.toolblaster.com"
      }]
    }
    </script>

    <!-- FAQ Schema for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "Is AgriQuiz free?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, AgriQuiz is completely free for all students preparing for agriculture exams."
        }
      }, {
        "@type": "Question",
        "name": "Do I need to sign up?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No, you do not need to create an account. Your progress is saved locally on your device."
        }
      }, {
        "@type": "Question",
        "name": "Which exams are covered?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It covers ICAR JRF, IBPS AFO, NABARD, and various State Agriculture exams with questions on Agronomy, Horticulture, and more."
        }
      }]
    }
    </script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon/web-app-manifest-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="48x48" href="favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#059669">
    <meta name="theme-color" content="#ffffff">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS Linked -->
    <link rel="stylesheet" href="js/style.css">

    <!-- Theme Initialization Script -->
    <script>
        // Apply theme immediately to prevent flash
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</head>
<body>

<!-- Fallback for disabled JavaScript -->
<noscript>
    <div style="padding: 20px; text-align: center; color: #7f1d1d; background: #fef2f2;">
        <strong>JavaScript is required.</strong> Please enable JavaScript to use the AgriQuiz application.
    </div>
</noscript>

<div class="progress-container"><div class="progress-fill" id="progressFill"></div></div>

<header>
    <div class="header-content">
        <a href="#" class="brand">
            <i class="fa-solid fa-seedling brand-icon"></i>
            <div class="brand-name">
                AgriQuiz
                <span class="brand-sub">by toolblaster.com</span>
            </div>
        </a>
        <div class="header-actions">
            <!-- Backup & Restore Controls -->
            <button class="theme-btn" onclick="exportProgress()" aria-label="Backup Progress" title="Backup Progress (Download)">
                <i class="fa-solid fa-download"></i>
            </button>
            <label for="importFile" class="theme-btn" aria-label="Restore Progress" title="Restore Progress (Upload)" style="cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0;">
                <i class="fa-solid fa-upload"></i>
            </label>
            <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importProgress(this)">

            <!-- Theme Toggle -->
            <button class="theme-btn" id="themeBtn" onclick="toggleTheme()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode">
                <i class="fa-solid fa-moon"></i>
            </button>
            
            <button class="reset-btn" onclick="resetProgress()">Reset</button>
        </div>
    </div>
</header>

<!-- Main Landmark for Accessibility -->
<main>
    <div class="main-layout">
        
        <!-- Left Column: Hero Content (50%) -->
        <section class="hero-section">
            <span class="hero-badge">Exam Ready 2026</span>
            <!-- H1 Optimized for SEO -->
            <h1 class="hero-title">Master Your<br>Agriculture Exam Preparation</h1>
            <p class="hero-desc">
                Unlock access to <strong>407+ curated questions</strong> tailored for ICAR, IBPS AFO, and NABARD. 
                Our interactive, <strong>bilingual (English & Hindi)</strong> quiz system is designed to challenge your brain, boost retention, and ensure you are exam-ready for 2026.
            </p>
            
            <!-- Key Subjects Section (Compact) -->
            <div class="subjects-container">
                <!-- Corrected Heading Level from H3 to H2 -->
                <h2 class="subjects-title">Key Subjects Covered</h2>
                <div class="subject-tags">
                    <!-- Updated with specific requested topics -->
                    <span class="subject-tag"><i class="fa-solid fa-wheat-awn"></i> Food Crops</span>
                    <span class="subject-tag"><i class="fa-solid fa-rotate"></i> Cropping Patterns</span>
                    <span class="subject-tag"><i class="fa-solid fa-tree"></i> Forests & Types</span>
                    <span class="subject-tag"><i class="fa-solid fa-cubes"></i> Minerals</span>
                    <span class="subject-tag"><i class="fa-solid fa-bolt"></i> Power & Energy</span>
                    <span class="subject-tag"><i class="fa-solid fa-industry"></i> Industries</span>
                    <span class="subject-tag"><i class="fa-solid fa-truck-plane"></i> Transport & Comm.</span>
                    <span class="subject-tag"><i class="fa-solid fa-cloud-showers-heavy"></i> Water Harvesting</span>
                    <span class="subject-tag"><i class="fa-solid fa-map"></i> Land Use Pattern</span>
                    <span class="subject-tag"><i class="fa-solid fa-hand-holding-heart"></i> Conservation</span>
                    <span class="subject-tag"><i class="fa-solid fa-tractor"></i> Farming Types</span>
                </div>
            </div>

            <!-- Platform Features Section -->
            <div class="subjects-container">
                <h2 class="subjects-title">Platform Features</h2>
                <div class="features-grid">
                    <div class="feature-item"><i class="fa-solid fa-book"></i> Bilingual Questions</div>
                    <div class="feature-item"><i class="fa-solid fa-floppy-disk"></i> Auto-Save Progress</div>
                    <div class="feature-item"><i class="fa-solid fa-bolt"></i> Instant Feedback</div>
                    <div class="feature-item"><i class="fa-solid fa-mobile-screen"></i> Mobile Optimized</div>
                    <div class="feature-item"><i class="fa-solid fa-magnifying-glass"></i> Smart Search</div>
                    <div class="feature-item"><i class="fa-solid fa-user-shield"></i> No Sign-up</div>
                    <div class="feature-item"><i class="fa-solid fa-download"></i> Backup & Restore</div>
                    <div class="feature-item"><i class="fa-solid fa-location-crosshairs"></i> Jump Navigation</div>
                </div>
            </div>
        </section>

        <!-- Right Column: Compact Quiz Widget (50%) -->
        <section class="quiz-widget-wrapper">
            <div class="quiz-card">
                
                <!-- Widget Header -->
                <div class="widget-header">
                    <!-- Compact Search with Clear Button -->
                    <div class="search-container" id="searchContainer">
                        <i class="fa-solid fa-magnifying-glass search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search topics...">
                        <i class="fa-solid fa-xmark search-clear" id="searchClear" onclick="clearSearch()" title="Clear Search"></i>
                    </div>
                    <!-- Text Size Adjuster -->
                    <div class="text-controls">
                        <button class="text-btn" onclick="adjustFont(-1)" title="Smaller Text">A-</button>
                        <button class="text-btn" onclick="adjustFont(1)" title="Larger Text">A+</button>
                    </div>
                </div>

                <!-- Stats Dashboard (Updated to 5 items) -->
                <div class="stats-dashboard">
                    <div class="stat-item">
                        <span class="stat-label">Done</span>
                        <span class="stat-value" id="statDone">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Left</span>
                        <span class="stat-value" id="statLeft">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Correct</span>
                        <span class="stat-value green" id="statCorrect">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Wrong</span>
                        <span class="stat-value red" id="statWrong">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Accuracy</span>
                        <span class="stat-value accent" id="statAccuracy">0%</span>
                    </div>
                </div>

                <!-- Scrollable Questions Area -->
                <div id="quizContent" class="quiz-content">
                    <div id="cardArea">
                        <div style="text-align:center; padding: 40px; color: #9CA3AF; font-size: 0.9rem;">
                            Loading Quiz Data...
                        </div>
                    </div>
                </div>

                <!-- Integrated Footer Controls -->
                <div class="widget-controls">
                    <button id="prevBtn" class="nav-btn" aria-label="Previous">
                        <i class="fa-solid fa-arrow-left"></i> Prev
                    </button>
                    
                    <!-- Enhanced Jump Feature -->
                    <div class="jump-trigger" id="jumpTrigger" title="Tap to Jump to specific question">
                        <span class="progress-text" id="progressText">0 / 0</span>
                        <span class="jump-label">
                            <i class="fa-solid fa-location-crosshairs"></i> Jump To
                        </span>
                    </div>

                    <button id="nextBtn" class="nav-btn" aria-label="Next">
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>

            </div>
        </section>

    </div>

    <!-- Modern Separator Line -->
    <div class="section-separator"></div>

    <!-- SEO Content Section (Compact & Dense) -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <h2>Comprehensive Agriculture & Resources Guide</h2>
            <p>A complete study resource covering agricultural practices, natural resources, industries, and infrastructure essential for competitive exams.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <h3><i class="fa-solid fa-wheat-awn"></i> Agriculture & Farming Systems</h3>
                <p>Understand the diverse types of farming practiced in India: <strong>Primitive Subsistence</strong>, <strong>Intensive Subsistence</strong>, and <strong>Commercial Farming</strong>. Master major food crops and cropping seasons (Rabi, Kharif, Zaid).</p>
                <ul class="seo-list">
                    <li>Major crops: Rice, Wheat, Millets, Pulses</li>
                    <li>Cropping patterns & climatic requirements</li>
                    <li>Plantation agriculture & cash crops</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-tree"></i> Forests & Land Resources</h3>
                <p>Study the classification of forests, flora, and fauna. Analyze India's land use patterns, causes of land degradation, and essential conservation measures for sustainable development.</p>
                <ul class="seo-list">
                    <li>Types of Forests: Reserved, Protected, Unclassed</li>
                    <li>Land degradation causes & soil conservation</li>
                    <li>Biodiversity & ecological balance</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-cubes"></i> Minerals & Power Resources</h3>
                <p>Deep dive into the distribution of metallic and non-metallic minerals. Explore conventional (Coal, Petroleum) and non-conventional (Solar, Wind, Biogas) sources of energy/power.</p>
                <ul class="seo-list">
                    <li>Ferrous vs Non-Ferrous minerals</li>
                    <li>Conventional vs Non-Conventional energy</li>
                    <li>Conservation of mineral resources</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-industry"></i> Industries & Occupations</h3>
                <p>Learn about the classification of industries based on raw materials, capital investment, and ownership. Understand the relationship between agriculture and agro-based industries.</p>
                <ul class="seo-list">
                    <li>Agro-based vs Mineral-based industries</li>
                    <li>Industrial pollution & environmental degradation</li>
                    <li>Primary, Secondary, & Tertiary occupations</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-truck-plane"></i> Transport & Communication</h3>
                <p>The lifelines of the national economy. Study the extensive network of Roadways, Railways, Pipelines, Waterways, and Airways, along with modern communication systems.</p>
                <ul class="seo-list">
                    <li>Golden Quadrilateral & National Highways</li>
                    <li>Major Sea Ports & Inland Waterways</li>
                    <li>Mass communication & international trade</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-cloud-showers-heavy"></i> Water Resources & Harvesting</h3>
                <p>Focus on water scarcity, the need for conservation, and multi-purpose river projects. Learn traditional and modern methods of rainwater harvesting practiced across India.</p>
                <ul class="seo-list">
                    <li>Roof-top rainwater harvesting techniques</li>
                    <li>Hydraulic structures in ancient India</li>
                    <li>Integrated water resources management</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Modern Separator Line for Author Section -->
    <div class="section-separator"></div>

    <!-- Trust & Effectiveness Section -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <h2><i class="fa-solid fa-shield-halved" style="color: var(--primary); margin-right: 10px;"></i>Why Trust AgriQuiz?</h2>
            <p>Our commitment to accuracy, pedagogical effectiveness, and user privacy.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <h3><i class="fa-solid fa-check-double"></i> Verified Accuracy</h3>
                <p>
                    Every question in our 407+ database is cross-referenced with standard agricultural textbooks and official answer keys from <strong>ICAR, IBPS, and NABARD</strong>. We prioritize correctness to ensure your exam preparation is built on a solid foundation.
                </p>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-brain"></i> Active Learning</h3>
                <p>
                    We utilize <strong>Active Recall</strong> technology. Unlike passive reading, our interactive widget forces your brain to retrieve information, strengthening memory pathways. Instant feedback ensures you correct mistakes immediately, a key factor in high-retention learning.
                </p>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-user-shield"></i> Privacy & Integrity</h3>
                <p>
                    We adhere to a strict <strong>user-first policy</strong>. There are no hidden paywalls, no mandatory sign-ups, and no intrusive data tracking. Your progress is saved locally on your device, ensuring your study habits remain private and secure.
                </p>
            </div>
        </div>
    </section>

    <!-- Modern Separator Line -->
    <div class="section-separator"></div>

    <!-- How to & FAQ Section -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <h2><i class="fa-solid fa-circle-info" style="color: var(--primary); margin-right: 10px;"></i>Help & Common Questions</h2>
            <p>Quick guide to using the platform and answers to frequent queries.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <h3><i class="fa-solid fa-list-check"></i> How to Use AgriQuiz</h3>
                <p>Maximize your study sessions with these simple steps:</p>
                <ul class="seo-list">
                    <li><strong>Start:</strong> Read the bilingual question (English/Hindi).</li>
                    <li><strong>Answer:</strong> Tap an option. <span style="color:var(--primary)">Green</span> is correct, <span style="color:#EF4444">Red</span> is wrong.</li>
                    <li><strong>Navigate:</strong> Use "Next", "Prev", or "Jump To" to move around.</li>
                    <li><strong>Search:</strong> Find topics like "Rice" or "Soil" instantly.</li>
                </ul>
            </div>

            <div class="seo-card">
                <h3><i class="fa-solid fa-circle-question"></i> Frequently Asked Questions</h3>
                <ul class="seo-list">
                    <li><strong>Is it free?</strong> Yes, 100% free study resource.</li>
                    <li><strong>Do I need to login?</strong> No, no sign-up required.</li>
                    <li><strong>Is progress saved?</strong> Yes, automatically on this device.</li>
                    <li><strong>Which exams?</strong> ICAR, IBPS AFO, NABARD & more.</li>
                </ul>
            </div>
        </div>
    </section>
</main>

<!-- Footer Section -->
<footer class="site-footer">
    <div class="footer-inner">
        <span>&copy; 2026 AgriQuiz by <a href="https://toolblaster.com" style="color: var(--primary-dark); text-decoration: none; font-weight: 600;">toolblaster.com</a>.</span>
        
        <!-- Legal Links Added Here -->
        <span class="footer-links">
            <a href="legal/about.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">About</a> |
            <a href="legal/privacy.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">Privacy</a> |
            <a href="legal/terms.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">Terms</a>
        </span>

        <button onclick="shareApp()" class="footer-share-btn" title="Share this page">
            <i class="fa-solid fa-share-nodes"></i> <span class="share-text">Share</span>
        </button>
    </div>
</footer>

<!-- Data Loading -->
<script>
    window.quizData = []; 
</script>

<!-- Scripts for Data Parts -->
<script src="js/part1.js"></script>
<script src="js/part2.js"></script>
<script src="js/part3.js"></script>
<script src="js/part4.js"></script>

<!-- Main Logic -->
<script>
    const STORAGE_KEY = 'agri_vantage_history_v1';
    
    let currentList = [];
    let currentIndex = 0;
    let historyState = { lastIndex: 0, answers: {} };
    // Changed default to -1 (A-) as requested for fresh load preference
    let fontLevel = -1; 
    let currentSearchTerm = '';

    // DOM Elements
    const cardArea = document.getElementById('cardArea');
    const quizContent = document.getElementById('quizContent');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressText = document.getElementById('progressText');
    const progressFill = document.getElementById('progressFill');
    const searchInput = document.getElementById('searchInput');
    const searchContainer = document.getElementById('searchContainer');
    const themeBtn = document.getElementById('themeBtn');
    const jumpTrigger = document.getElementById('jumpTrigger');

    window.onload = () => {
        // Initialize Theme Icon
        const currentTheme = document.documentElement.getAttribute('data-theme');
        updateThemeIcon(currentTheme);

        // Wait 100ms for parts to load
        setTimeout(() => {
            if (window.quizData && window.quizData.length > 0) {
                // Sort by ID
                window.quizData.sort((a, b) => a.id - b.id);
                
                loadFromStorage();
                currentList = [...window.quizData];
                
                if (historyState.lastIndex && historyState.lastIndex < currentList.length) {
                    currentIndex = historyState.lastIndex;
                }
                loadQuestion(currentIndex);
                updateStats(); // Init stats
            } else {
                cardArea.innerHTML = `<div style="text-align:center; color:#EF4444; padding:20px; font-size:0.9rem;">
                    <strong>Data Missing</strong><br>
                    Please create <code>js/part1.js</code> to start.
                </div>`;
            }
        }, 100);
    };

    function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        updateThemeIcon(next);
    }

    function updateThemeIcon(theme) {
        if(theme === 'dark') {
            themeBtn.innerHTML = '<i class="fa-solid fa-sun"></i>';
        } else {
            themeBtn.innerHTML = '<i class="fa-solid fa-moon"></i>';
        }
    }

    // Export Progress
    window.exportProgress = function() {
        const dataStr = JSON.stringify(historyState);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'agriquiz_backup.json';
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // Import Progress
    window.importProgress = function(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const contents = JSON.parse(e.target.result);
                if (contents && contents.answers) {
                    historyState = contents;
                    saveToStorage();
                    
                    // Reset to last index in imported data
                    if(historyState.lastIndex && historyState.lastIndex < currentList.length) {
                        currentIndex = historyState.lastIndex;
                    } else {
                        currentIndex = 0;
                    }
                    
                    loadQuestion(currentIndex);
                    updateStats();
                    alert('Progress restored successfully!');
                } else {
                    alert('Invalid backup file. Please ensure it is a valid AgriQuiz JSON file.');
                }
            } catch(err) {
                alert('Error reading file. Please try again.');
            }
        };
        reader.readAsText(file);
        // Reset input so same file can be selected again if needed
        input.value = '';
    }

    function adjustFont(dir) {
        fontLevel += dir;
        // Limit range
        if(fontLevel > 3) fontLevel = 3;
        if(fontLevel < -1) fontLevel = -1;
        loadQuestion(currentIndex);
    }

    function getFontSize() {
        // Unified size logic for Question and Options
        const baseSize = 0.9; // Adjusted base size to 0.9rem (approx 14.4px)
        const step = 0.1; // Adjusted step to 0.1rem
        // Current Level Logic:
        // Level -1 (Default): 0.9 + 0 = 0.9rem (~14.4px)
        // Level 0 (First +): 0.9 + 0.1 = 1.0rem (16px) - User Requested
        // Level 1: 1.1rem (~17.6px)
        const offset = fontLevel + 1; 
        return `${baseSize + (offset * step)}rem`;
    }

    function updateStats() {
        const total = window.quizData.length;
        const completedIds = Object.keys(historyState.answers);
        const completedCount = completedIds.length;
        const leftCount = total - completedCount;
        
        let correctCount = 0;
        completedIds.forEach(id => {
            const q = window.quizData.find(item => item.id == id);
            if (q && q.answer === historyState.answers[id]) {
                correctCount++;
            }
        });
        
        const wrongCount = completedCount - correctCount;
        const accuracy = completedCount > 0 ? Math.round((correctCount / completedCount) * 100) : 0;

        document.getElementById('statDone').innerText = completedCount;
        document.getElementById('statLeft').innerText = leftCount;
        document.getElementById('statCorrect').innerText = correctCount;
        document.getElementById('statWrong').innerText = wrongCount;
        document.getElementById('statAccuracy').innerText = accuracy + '%';
    }

    // Highlighting Helper
    function highlightText(text, term) {
        if (!term || term.length < 2) return text;
        // Escape special regex chars
        const safeTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(${safeTerm})`, 'gi');
        return text.replace(regex, '<mark class="highlight">$1</mark>');
    }

    function loadQuestion(index) {
        quizContent.scrollTop = 0;

        if (currentList.length === 0) {
            cardArea.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-file-circle-question"></i>
                    <p>No matches found for "<strong>${currentSearchTerm}</strong>"</p>
                    <button onclick="clearSearch()">Clear Search</button>
                </div>`;
            updateControls();
            return;
        }

        const q = currentList[index];
        const savedAnswer = historyState.answers[q.id];
        // Ensure strictly that it is a number (index) to avoid 'null' or garbage causing locked state
        const isAnswered = (savedAnswer !== undefined && savedAnswer !== null && typeof savedAnswer === 'number');
        
        // Get unified font size
        const fontSize = getFontSize();

        // Apply highlighting
        const qEnText = highlightText(q.questionEn, currentSearchTerm);
        const qHiText = highlightText(q.questionHi, currentSearchTerm);

        const optionsHtml = q.options.map((opt, i) => {
            let statusClass = '';
            let iconHtml = '';
            
            // Apply highlighting to options
            const optText = highlightText(opt, currentSearchTerm);
            
            if (isAnswered) {
                if (i === q.answer) { 
                    statusClass = 'correct'; 
                    iconHtml = '<span class="status-icon"><i class="fa-solid fa-check"></i></span>'; 
                } 
                else if (i === savedAnswer) { 
                    statusClass = 'wrong'; 
                    iconHtml = '<span class="status-icon"><i class="fa-solid fa-xmark"></i></span>'; 
                }
            }
            
            // Applied inline style for font-size to ensure option buttons resize with the adjuster
            // Added safe quotes around ID to prevent JS error on strings
            return `
            <div class="option-btn ${statusClass} ${isAnswered ? 'disabled' : ''}" 
                 style="font-size: ${fontSize};"
                 onclick="handleAnswer(this, '${q.id}', ${i})">
                <span>${optText}</span>
                ${iconHtml}
            </div>`;
        }).join('');

        let feedbackHtml = '';
        if (isAnswered) {
            const isCorrect = savedAnswer === q.answer;
            const bg = isCorrect ? 'var(--correct-bg)' : 'var(--wrong-bg)';
            const color = isCorrect ? 'var(--correct-text)' : 'var(--wrong-text)';
            const text = isCorrect ? 'Correct Answer!' : `Correct: ${q.options[q.answer]}`;
            feedbackHtml = `<div class="feedback-msg" style="display:block; background:${bg}; color:${color}">${text}</div>`;
        }

        const listClass = isAnswered ? 'options-list answered' : 'options-list';
        
        const statusDisplay = isAnswered 
            ? (savedAnswer === q.answer 
                ? '<i class="fa-solid fa-check"></i> Solved' 
                : '<i class="fa-solid fa-xmark"></i> Review') 
            : 'Pending';

        cardArea.innerHTML = `
            <div class="q-meta">
                <span>Q. ${q.id}</span>
                <span style="color:var(--primary)">${statusDisplay}</span>
            </div>
            <div class="q-text-en" style="font-size:${fontSize}">${qEnText}</div>
            <div class="q-text-hi" style="font-size:${fontSize}">${qHiText}</div>
            <div class="${listClass}" id="opts-${q.id}">
                ${optionsHtml}
            </div>
            ${feedbackHtml}
        `;

        // Only save position if NOT searching to prevent overwriting 'bookmark' with search index
        if (searchInput.value === '') { 
            historyState.lastIndex = currentIndex;
            saveToStorage();
        }

        updateControls();
    }

    window.handleAnswer = function(btn, qId, choiceIndex) {
        // Safety Check
        if (!currentList || !currentList[currentIndex]) return;
        
        const q = currentList[currentIndex];
        historyState.answers[qId] = choiceIndex;
        saveToStorage();
        updateStats(); 
        loadQuestion(currentIndex);
    };

    nextBtn.addEventListener('click', () => {
        if (currentIndex < currentList.length - 1) {
            currentIndex++;
            loadQuestion(currentIndex);
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            loadQuestion(currentIndex);
        }
    });

    // Jump Logic: Click on Progress Text/Icon
    jumpTrigger.addEventListener('click', () => {
        const max = currentList.length;
        // Pre-fill prompt with current question number for convenience
        const p = prompt(`Enter Question Number (1 - ${max}) to jump:`, currentIndex + 1);
        
        if (p) {
            const num = parseInt(p);
            if (!isNaN(num) && num >= 1 && num <= max) {
                currentIndex = num - 1;
                loadQuestion(currentIndex);
            } else {
                if(p.trim() !== "") alert(`Please enter a valid number between 1 and ${max}.`);
            }
        }
    });

    document.addEventListener('keydown', (e) => {
        if (document.activeElement !== searchInput) {
            if (e.key === 'ArrowRight' && !nextBtn.disabled) nextBtn.click();
            if (e.key === 'ArrowLeft' && !prevBtn.disabled) prevBtn.click();
        }
    });

    function updateControls() {
        if (!currentList || currentList.length === 0) {
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            progressText.innerText = `0 / 0`;
            progressFill.style.width = `0%`;
            return;
        }

        const currentQ = currentList[currentIndex];
        const isAnswered = historyState.answers[currentQ.id] !== undefined;

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = (currentIndex === currentList.length - 1) || !isAnswered;

        progressText.innerText = `${currentIndex + 1} / ${currentList.length}`;
        const pct = ((currentIndex + 1) / currentList.length) * 100;
        progressFill.style.width = `${pct}%`;
    }

    // Enhanced Search Logic
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase().trim();
        currentSearchTerm = term;
        
        // Toggle Clear Button
        if (term.length > 0) {
            searchContainer.classList.add('active');
        } else {
            searchContainer.classList.remove('active');
        }
        
        if (term === '') {
            currentList = [...window.quizData];
            if (historyState.lastIndex !== undefined && historyState.lastIndex < currentList.length) {
                currentIndex = historyState.lastIndex;
            } else {
                currentIndex = 0;
            }
        } else {
            // Filter logic including options and IDs
            currentList = window.quizData.filter(q => {
                const qEn = q.questionEn ? q.questionEn.toLowerCase() : '';
                const qHi = q.questionHi ? q.questionHi.toLowerCase() : ''; 
                const qId = q.id ? q.id.toString() : '';
                const optionsStr = q.options ? q.options.join(' ').toLowerCase() : '';

                return qEn.includes(term) || qHi.includes(term) || qId.includes(term) || optionsStr.includes(term);
            });
            currentIndex = 0;
        }
        
        loadQuestion(currentIndex);
    });

    window.clearSearch = function() {
        searchInput.value = '';
        searchInput.dispatchEvent(new Event('input')); // Trigger input event to reset
        searchInput.focus();
    };
    
    // Share Logic
    window.shareApp = async function() {
        const canonical = document.querySelector('link[rel="canonical"]')?.href || window.location.href;
        const btn = document.querySelector('.footer-share-btn');
        const originalHtml = btn.innerHTML;

        if (navigator.share) {
            try {
                await navigator.share({
                    // Only sharing URL as requested
                    url: canonical
                });
            } catch (err) {
                console.log('Share canceled');
            }
        } else {
            // Fallback for desktop/unsupported browsers
            try {
                await navigator.clipboard.writeText(canonical);
                btn.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                }, 2000);
            } catch (err) {
                alert('Could not copy URL');
            }
        }
    };

    function saveToStorage() { localStorage.setItem(STORAGE_KEY, JSON.stringify(historyState)); }
    function loadFromStorage() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) { try { historyState = JSON.parse(saved); if (!historyState.answers) historyState.answers = {}; } catch (e) {} }
    }
    window.resetProgress = function() {
        if(confirm("Clear history?")) { localStorage.removeItem(STORAGE_KEY); location.reload(); }
    };
</script>
</body>
</html>
