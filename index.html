<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Optimized Meta Description for SEO (Evergreen) -->
    <meta name="description" content="Free General Agriculture Mock Test. Attempt 507+ bilingual questions (English/Hindi) for ICAR JRF, IBPS AFO, NABARD & State Agri Exams. No login required.">
    <!-- Optimized Title Tag (Evergreen) -->
    <title>AgriQuiz: Free Agriculture Mock Test & Exam Prep</title>
    
    <!-- Canonical Link (Prevents duplicate content issues) -->
    <link rel="canonical" href="https://agriquiz.toolblaster.com/">

    <!-- Open Graph / Facebook / LinkedIn -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://agriquiz.toolblaster.com/">
    <meta property="og:title" content="AgriQuiz: Free Agriculture Mock Test & Exam Prep">
    <meta property="og:description" content="Free General Agriculture Mock Test. Attempt 507+ bilingual questions for ICAR JRF, IBPS AFO. Instant results, no login.">
    <!-- Updated to use the high-quality 512px favicon -->
    <meta property="og:image" content="https://agriquiz.toolblaster.com/favicon/web-app-manifest-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary"> <!-- Changed to summary since we are using a square icon -->
    <meta property="twitter:url" content="https://agriquiz.toolblaster.com/">
    <meta property="twitter:title" content="AgriQuiz: Free Agriculture Mock Test & Exam Prep">
    <meta property="twitter:description" content="Free General Agriculture Mock Test. Attempt 507+ bilingual questions for ICAR JRF, IBPS AFO. Instant results, no login.">
    <!-- Updated to use the high-quality 512px favicon -->
    <meta property="twitter:image" content="https://agriquiz.toolblaster.com/favicon/web-app-manifest-512x512.png">

    <!-- JSON-LD Schema for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "AgriQuiz",
      "operatingSystem": "Web",
      "applicationCategory": "EducationalApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "ToolBlaster",
        "url": "https://toolblaster.com"
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "1250",
        "bestRating": "5",
        "worstRating": "1"
      }
    }
    </script>
    
    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://agriquiz.toolblaster.com"
      }]
    }
    </script>

    <!-- FAQ Schema for Rich Snippets -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "Is AgriQuiz free?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, AgriQuiz is completely free for all students preparing for agriculture exams."
        }
      }, {
        "@type": "Question",
        "name": "Do I need to sign up?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "No, you do not need to create an account. Your progress is saved locally on your device."
        }
      }, {
        "@type": "Question",
        "name": "Which exams are covered?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It covers ICAR JRF, IBPS AFO, NABARD, and various State Agriculture exams with questions on Agronomy, Horticulture, and more."
        }
      }, {
        "@type": "Question",
        "name": "How do I save my progress?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Use the Download icon in the header to save a backup file, and use the Upload icon to restore it on any device."
        }
      }, {
        "@type": "Question",
        "name": "Is the content available in Hindi?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, every question is bilingual and displayed in both English and Hindi simultaneously."
        }
      }, {
        "@type": "Question",
        "name": "Is this useful for State Agriculture Exams?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. The General Agriculture syllabus covered here is essential for state exams like ADO, RAEO, RHEO, and AHO."
        }
      }]
    }
    </script>

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="favicon/web-app-manifest-512x512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="favicon/web-app-manifest-192x192.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="48x48" href="favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="shortcut icon" href="favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#047857">
    <meta name="theme-color" content="#ffffff">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS Linked -->
    <link rel="stylesheet" href="js/style.css">
    
    <!-- ACCESSIBILITY OVERRIDES: Ensuring WCAG AA Contrast Compliance -->
    <style>
        :root {
            /* Contrast Fix: 
               Original Green (#059669) was ~3.0:1 against white (Fail).
               New Green (#047857) is ~4.5:1 against white (Pass AA).
            */
            --primary: #047857; 
            --primary-hover: #065f46;
            
            /* Darker text for secondary information to pass 4.5:1 */
            --text-sec: #4b5563; 
            
            /* Status colors tuned for better visibility */
            --correct-text: #14532d; /* Darker green text */
            --wrong-text: #7f1d1d; /* Darker red text */
            
            --heading-text: #1f2937; /* Dark Grey for headings */
            --body-text: #374151; /* Dark Grey for body text */
        }

        /* Dark Mode Adjustments */
        [data-theme="dark"] {
            /* Lighter green against dark background for visibility */
            --primary: #34d399; 
            --text-sec: #d1d5db;
            
            --correct-text: #86efac;
            --wrong-text: #fca5a5;
            
            --heading-text: #f9fafb;
            --body-text: #e5e7eb;
        }

        /* Focus indicators for keyboard accessibility */
        :focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }

        /* Specific Overrides for Content Cards to guarantee contrast */
        .seo-card h3 {
            color: var(--heading-text) !important;
        }
        .seo-card p, .seo-list li {
            color: var(--body-text) !important;
        }
    </style>

    <!-- Theme Initialization Script -->
    <script>
        // Apply theme immediately to prevent flash
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
    </script>
</head>
<body>

<!-- Fallback for disabled JavaScript -->
<noscript>
    <div style="padding: 20px; text-align: center; color: #7f1d1d; background: #fef2f2;">
        <strong>JavaScript is required.</strong> Please enable JavaScript to use the AgriQuiz application.
    </div>
</noscript>

<div class="progress-container"><div class="progress-fill" id="progressFill"></div></div>

<header>
    <div class="header-content">
        <a href="#" class="brand">
            <i class="fa-solid fa-seedling brand-icon"></i>
            <div class="brand-name">
                AgriQuiz
                <span class="brand-sub">by toolblaster.com</span>
            </div>
        </a>
        <div class="header-actions">
            <!-- Backup & Restore Controls -->
            <button class="theme-btn" onclick="exportProgress()" aria-label="Backup Progress" title="Backup Progress (Download)">
                <i class="fa-solid fa-download"></i>
            </button>
            <label for="importFile" class="theme-btn" aria-label="Restore Progress" title="Restore Progress (Upload)" style="cursor: pointer; display: flex; align-items: center; justify-content: center; margin: 0;">
                <i class="fa-solid fa-upload"></i>
            </label>
            <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importProgress(this)">

            <!-- Theme Toggle -->
            <button class="theme-btn" id="themeBtn" onclick="toggleTheme()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode">
                <i class="fa-solid fa-moon"></i>
            </button>
            
            <button class="reset-btn" onclick="resetProgress()">Reset</button>
        </div>
    </div>
</header>

<!-- Main Landmark for Accessibility -->
<main>
    <div class="main-layout">
        
        <!-- Left Column: Hero Content (50%) -->
        <section class="hero-section">
            <span class="hero-badge">Exam Ready</span>
            <!-- H1: Main Title -->
            <h1 class="hero-title">Free General Agriculture<br>Mock Test & Exam Prep</h1>
            <p class="hero-desc">
                Unlock access to <strong>507+ curated questions</strong> tailored for <strong>ICAR JRF, IBPS AFO, and NABARD</strong>. 
                Our interactive, <strong>bilingual (English & Hindi)</strong> quiz system challenges your brain, boosts retention, and ensures you are exam-ready.
            </p>
            
            <!-- NEW: Quick Start CTA -->
            <button class="hero-cta-btn" onclick="toggleQuickMode(true)">
                <i class="fa-solid fa-bolt"></i> Start Quick 10 Quiz
            </button>
            
            <!-- Key Subjects Section (Compact) -->
            <div class="subjects-container">
                <!-- H2: Major Section Heading -->
                <h2 class="subjects-title">Key Subjects Covered</h2>
                <div class="subject-tags">
                    <!-- Updated with specific requested topics and keywords -->
                    <span class="subject-tag"><i class="fa-solid fa-wheat-awn"></i> General Agriculture</span>
                    <span class="subject-tag"><i class="fa-solid fa-seedling"></i> Agronomy</span>
                    <span class="subject-tag"><i class="fa-solid fa-tree"></i> Forestry</span>
                    <span class="subject-tag"><i class="fa-solid fa-leaf"></i> Horticulture</span>
                    <span class="subject-tag"><i class="fa-solid fa-flask"></i> Soil Science</span>
                    <span class="subject-tag"><i class="fa-solid fa-rotate"></i> Cropping Patterns</span>
                    <span class="subject-tag"><i class="fa-solid fa-cloud-showers-heavy"></i> Irrigation</span>
                    <span class="subject-tag"><i class="fa-solid fa-tractor"></i> Farming Systems</span>
                </div>
            </div>

            <!-- Platform Features Section -->
            <div class="subjects-container">
                <!-- H2: Major Section Heading -->
                <h2 class="subjects-title">Platform Features</h2>
                <div class="features-grid">
                    <div class="feature-item"><i class="fa-solid fa-book"></i> Bilingual Questions</div>
                    <div class="feature-item"><i class="fa-solid fa-floppy-disk"></i> Auto-Save Progress</div>
                    <div class="feature-item"><i class="fa-solid fa-bolt"></i> Instant Feedback</div>
                    <div class="feature-item"><i class="fa-solid fa-mobile-screen"></i> Mobile Optimized</div>
                    <div class="feature-item"><i class="fa-solid fa-magnifying-glass"></i> Smart Search</div>
                    <div class="feature-item"><i class="fa-solid fa-user-shield"></i> No Sign-up</div>
                    <div class="feature-item"><i class="fa-solid fa-download"></i> Backup & Restore</div>
                    <div class="feature-item"><i class="fa-solid fa-location-crosshairs"></i> Jump Navigation</div>
                </div>
            </div>
        </section>

        <!-- Right Column: Compact Quiz Widget (50%) -->
        <section class="quiz-widget-wrapper" id="quizWidgetWrapper">
            <div class="quiz-card">
                
                <!-- Widget Header -->
                <div class="widget-header">
                    <!-- Compact Search with Clear Button -->
                    <div class="search-container" id="searchContainer">
                        <i class="fa-solid fa-magnifying-glass search-icon"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Search topics...">
                        <i class="fa-solid fa-xmark search-clear" id="searchClear" onclick="clearSearch()" title="Clear Search"></i>
                    </div>
                    <!-- Text Size Adjuster, Bookmark, Mistake, Shuffle & Quick Filter -->
                    <div class="text-controls">
                        <!-- Quick Mode Button -->
                        <button class="quick-btn" id="quickModeBtn" onclick="toggleQuickMode()" title="Toggle Quick 10 Mode">
                            <i class="fa-solid fa-bolt"></i>
                        </button>
                        <!-- Shuffle Button -->
                        <button class="shuffle-btn" id="shuffleBtn" onclick="toggleShuffle()" title="Shuffle Questions (Randomize Order)">
                            <i class="fa-solid fa-shuffle"></i>
                        </button>
                        <!-- Mistakes Filter Button -->
                        <button class="mistake-btn" id="mistakeFilterBtn" onclick="toggleMistakeFilter()" title="Show Mistakes Only (Smart Review)">
                            <i class="fa-solid fa-triangle-exclamation"></i>
                        </button>
                        <!-- Bookmark Filter Button -->
                        <button class="bookmark-btn" id="bookmarkFilterBtn" onclick="toggleBookmarkFilter()" title="Show Bookmarked Questions">
                            <i class="fa-regular fa-bookmark"></i>
                        </button>
                        <button class="text-btn" onclick="adjustFont(-1)" title="Smaller Text">A-</button>
                        <button class="text-btn" onclick="adjustFont(1)" title="Larger Text">A+</button>
                    </div>
                </div>

                <!-- Stats Dashboard (Updated to 5 items) -->
                <div class="stats-dashboard">
                    <div class="stat-item">
                        <span class="stat-label">Done</span>
                        <span class="stat-value" id="statDone">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Left</span>
                        <span class="stat-value" id="statLeft">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Correct</span>
                        <span class="stat-value green" id="statCorrect">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Wrong</span>
                        <span class="stat-value red" id="statWrong">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Accuracy</span>
                        <span class="stat-value accent" id="statAccuracy">0%</span>
                    </div>
                </div>

                <!-- Scrollable Questions Area -->
                <div id="quizContent" class="quiz-content">
                    <div id="cardArea">
                        <!-- Accessibility Fix: Changed color from #9CA3AF (Low Contrast) to #4B5563 (WCAG AA Compliant) -->
                        <div style="text-align:center; padding: 40px; color: #4B5563; font-size: 0.9rem;">
                            Loading Quiz Data...
                        </div>
                    </div>
                </div>

                <!-- Integrated Footer Controls -->
                <div class="widget-controls">
                    <button id="prevBtn" class="nav-btn" aria-label="Previous">
                        <i class="fa-solid fa-arrow-left"></i> Prev
                    </button>
                    
                    <!-- Enhanced Jump Feature -->
                    <div class="jump-trigger" id="jumpTrigger" title="Tap to Jump to specific question">
                        <span class="progress-text" id="progressText">0 / 0</span>
                        <span class="jump-label">
                            <i class="fa-solid fa-location-crosshairs"></i> Jump To
                        </span>
                    </div>

                    <button id="nextBtn" class="nav-btn" aria-label="Next">
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>

            </div>
        </section>

    </div>

    <!-- Modern Separator Line -->
    <div class="section-separator"></div>

    <!-- SEO Content Section (Compact & Dense) -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <!-- H2: Major Section Heading -->
            <h2>Comprehensive Agriculture & Resources Guide</h2>
            <p>A complete study resource covering agricultural practices, natural resources, industries, and infrastructure essential for competitive exams.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-wheat-awn"></i> Agriculture & Farming Systems</h3>
                <p>Understand the diverse types of farming practiced in India: <strong>Primitive Subsistence</strong>, <strong>Intensive Subsistence</strong>, and <strong>Commercial Farming</strong>. Master major food crops and cropping seasons (Rabi, Kharif, Zaid).</p>
                <ul class="seo-list">
                    <li>Major crops: Rice, Wheat, Millets, Pulses</li>
                    <li>Cropping patterns & climatic requirements</li>
                    <li>Plantation agriculture & cash crops</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-tree"></i> Forests & Land Resources</h3>
                <p>Study the classification of forests, flora, and fauna. Analyze India's land use patterns, causes of land degradation, and essential conservation measures for sustainable development.</p>
                <ul class="seo-list">
                    <li>Types of Forests: Reserved, Protected, Unclassed</li>
                    <li>Land degradation causes & soil conservation</li>
                    <li>Biodiversity & ecological balance</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-cubes"></i> Minerals & Power Resources</h3>
                <p>Deep dive into the distribution of metallic and non-metallic minerals. Explore conventional (Coal, Petroleum) and non-conventional (Solar, Wind, Biogas) sources of energy/power.</p>
                <ul class="seo-list">
                    <li>Ferrous vs Non-Ferrous minerals</li>
                    <li>Conventional vs Non-Conventional energy</li>
                    <li>Conservation of mineral resources</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-industry"></i> Industries & Occupations</h3>
                <p>Learn about the classification of industries based on raw materials, capital investment, and ownership. Understand the relationship between agriculture and agro-based industries.</p>
                <ul class="seo-list">
                    <li>Agro-based vs Mineral-based industries</li>
                    <li>Industrial pollution & environmental degradation</li>
                    <li>Primary, Secondary, & Tertiary occupations</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-truck-plane"></i> Transport & Communication</h3>
                <p>The lifelines of the national economy. Study the extensive network of Roadways, Railways, Pipelines, Waterways, and Airways, along with modern communication systems.</p>
                <ul class="seo-list">
                    <li>Golden Quadrilateral & National Highways</li>
                    <li>Major Sea Ports & Inland Waterways</li>
                    <li>Mass communication & international trade</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-cloud-showers-heavy"></i> Water Resources & Harvesting</h3>
                <p>Focus on water scarcity, the need for conservation, and multi-purpose river projects. Learn traditional and modern methods of rainwater harvesting practiced across India.</p>
                <ul class="seo-list">
                    <li>Roof-top rainwater harvesting techniques</li>
                    <li>Hydraulic structures in ancient India</li>
                    <li>Integrated water resources management</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Modern Separator Line for Author Section -->
    <div class="section-separator"></div>

    <!-- Trust & Effectiveness Section -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <!-- H2: Major Section Heading -->
            <h2><i class="fa-solid fa-shield-halved" style="color: var(--primary); margin-right: 10px;"></i>Why Trust AgriQuiz?</h2>
            <p>Our commitment to accuracy, pedagogical effectiveness, and user privacy.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-check-double"></i> Verified Accuracy</h3>
                <p>
                    Every question in our 507+ database is cross-referenced with standard agricultural textbooks and official answer keys from <strong>ICAR, IBPS, and NABARD</strong>. We prioritize correctness to ensure your exam preparation is built on a solid foundation.
                </p>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-brain"></i> Active Learning</h3>
                <p>
                    We utilize <strong>Active Recall</strong> technology. Unlike passive reading, our interactive widget forces your brain to retrieve information, strengthening memory pathways. Instant feedback ensures you correct mistakes immediately, a key factor in high-retention learning.
                </p>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-user-shield"></i> Privacy & Integrity</h3>
                <p>
                    We adhere to a strict <strong>user-first policy</strong>. There are no hidden paywalls, no mandatory sign-ups, and no intrusive data tracking. Your progress is saved locally on your device, ensuring your study habits remain private and secure.
                </p>
            </div>
        </div>
    </section>

    <!-- Modern Separator Line -->
    <div class="section-separator"></div>

    <!-- How to & FAQ Section (Moved ABOVE Useful Resources) -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <!-- H2: Major Section Heading -->
            <h2><i class="fa-solid fa-circle-info" style="color: var(--primary); margin-right: 10px;"></i>Help & Common Questions</h2>
            <p>Quick guide to using the platform and answers to frequent queries.</p>
        </div>
        
        <div class="seo-grid">
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-list-check"></i> How to Use AgriQuiz</h3>
                <p>Maximize your study sessions with these simple steps:</p>
                <ul class="seo-list">
                    <li><strong>Start:</strong> Read the bilingual question (English/Hindi).</li>
                    <!-- Updated with high contrast variables for Green/Red text -->
                    <li><strong>Answer:</strong> Tap an option. <span style="color:var(--correct-text)">Green</span> is correct, <span style="color:var(--wrong-text)">Red</span> is wrong.</li>
                    <li><strong>Navigate:</strong> Use "Next", "Prev", or "Jump To" to move around.</li>
                    <li><strong>Search:</strong> Find topics like "Rice" or "Soil" instantly.</li>
                    <!-- NEW EXPLANATION FOR BACKUP/RESTORE -->
                    <li><strong>Backup/Restore:</strong> Use the <i class="fa-solid fa-download"></i> icon in the header to save your progress to a file, and <i class="fa-solid fa-upload"></i> to restore it later or on another device.</li>
                </ul>
            </div>

            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-circle-question"></i> Frequently Asked Questions</h3>
                <ul class="seo-list">
                    <li><strong>Is it free?</strong> Yes, 100% free study resource.</li>
                    <li><strong>Do I need to login?</strong> No, no sign-up required.</li>
                    <li><strong>Is progress saved?</strong> Yes, automatically on this device.</li>
                    <!-- NEW FAQ ITEM -->
                    <li><strong>Can I switch devices?</strong> Yes! Download your backup (<i class="fa-solid fa-download"></i>) and Upload it (<i class="fa-solid fa-upload"></i>) on the new device.</li>
                    <li><strong>Which exams?</strong> ICAR, IBPS AFO, NABARD & more.</li>
                    <!-- ADDED NEW FAQS BELOW -->
                    <li><strong>Is it bilingual?</strong> Yes, questions appear in English & Hindi.</li>
                    <li><strong>State Exams?</strong> Useful for ADO, RAEO, RHEO & others.</li>
                </ul>
            </div>

            <!-- New Recommended Resources Card (Updated Copy) -->
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-thumbs-up"></i> Top Study Picks</h3>
                <p>Curated materials to boost your preparation:</p>
                <ul class="seo-list">
                    <li style="margin-bottom: 12px;">
                        <strong><i class="fa-solid fa-book-open" style="color: var(--primary); margin-right: 5px;"></i> Recommended Book:</strong> 
                        <br>
                        <a href="https://amzn.to/4rewDKd" target="_blank" rel="nofollow" style="color: var(--primary); text-decoration: none; font-weight: 600;">Advanced Fundamentals of Agriculture (Vol 1 & 2)</a>
                        <div style="font-size: 0.9em; margin-top: 4px; color: var(--text-sec);">The definitive guide for ICAR, AFO, NABARD, and State Exams.</div>
                    </li>
                    <li>
                        <strong><i class="fa-solid fa-laptop-code" style="color: var(--primary); margin-right: 5px;"></i> Mock Test Series:</strong> 
                        <br>
                        <a href="https://testbook.com/invite/MMZ9MJ" target="_blank" rel="nofollow" style="color: var(--primary); text-decoration: none; font-weight: 600;">Join Testbook Premium Series</a>
                        <div style="font-size: 0.9em; margin-top: 4px; color: var(--text-sec);">Get access to high-quality mock tests and detailed analytics.</div>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <!-- Modern Separator Line -->
    <div class="section-separator"></div>

    <!-- NEW SECTION: Useful Resources (Moved BELOW How to & FAQ) -->
    <section class="seo-content-wrapper">
        <div class="seo-header">
            <!-- H2: Major Section Heading -->
            <h2><i class="fa-solid fa-link" style="color: var(--primary); margin-right: 10px;"></i>Useful Resources</h2>
            <p>Direct links to official agricultural boards and platform information.</p>
        </div>
        
        <div class="seo-grid">
            <!-- Outbound Links to Authority Sites -->
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-building-columns"></i> Official Boards</h3>
                <p>Visit official websites for notifications and syllabi:</p>
                <ul class="seo-list" style="list-style: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;"><a href="https://icar.org.in/" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-external-link-alt" style="margin-right: 5px;"></i> ICAR Official</a></li>
                    <li style="margin-bottom: 8px;"><a href="https://www.ibps.in/" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-external-link-alt" style="margin-right: 5px;"></i> IBPS Official</a></li>
                    <li><a href="https://www.nabard.org/" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-external-link-alt" style="margin-right: 5px;"></i> NABARD Official</a></li>
                </ul>
            </div>

            <!-- Internal Interlinking -->
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-circle-info"></i> Platform Info</h3>
                <p>Learn more about our data handling and terms:</p>
                <ul class="seo-list" style="list-style: none; padding-left: 0;">
                    <li style="margin-bottom: 8px;"><a href="legal/about.html" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-arrow-right" style="margin-right: 5px;"></i> About AgriQuiz</a></li>
                    <li style="margin-bottom: 8px;"><a href="legal/privacy.html" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-arrow-right" style="margin-right: 5px;"></i> Privacy Policy</a></li>
                    <li><a href="legal/terms.html" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-arrow-right" style="margin-right: 5px;"></i> Terms of Service</a></li>
                </ul>
            </div>

            <!-- Cross-Linking to Main Domain -->
            <div class="seo-card">
                <!-- H3: Sub-section Heading -->
                <h3><i class="fa-solid fa-laptop-code"></i> Developer</h3>
                <p>Built by ToolBlaster. Explore more:</p>
                <ul class="seo-list" style="list-style: none; padding-left: 0;">
                    <li><a href="https://toolblaster.com" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: none; font-weight: 600;"><i class="fa-solid fa-rocket" style="margin-right: 5px;"></i> More Tools @ ToolBlaster</a></li>
                </ul>
            </div>
        </div>
    </section>
</main>

<!-- Footer Section -->
<footer class="site-footer">
    <div class="footer-inner">
        <!-- Evergreen Footer: Year updates automatically -->
        <span>&copy; <span id="currentYear"></span> AgriQuiz by <a href="https://toolblaster.com" style="color: var(--primary-dark); text-decoration: none; font-weight: 600;">toolblaster.com</a>.</span>
        
        <!-- Legal Links Added Here -->
        <span class="footer-links">
            <a href="legal/about.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">About</a> |
            <a href="legal/privacy.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">Privacy</a> |
            <a href="legal/terms.html" style="color: var(--text-sec); text-decoration: none; font-size: 0.8rem; margin: 0 5px;">Terms</a>
        </span>

        <button onclick="shareApp()" class="footer-share-btn" title="Share this page">
            <i class="fa-solid fa-share-nodes"></i> <span class="share-text">Share</span>
        </button>
    </div>
</footer>

<!-- Data Loading -->
<script>
    window.quizData = []; 
</script>

<!-- Scripts for Data Parts -->
<script src="js/part1.js"></script>
<script src="js/part2.js"></script>
<script src="js/part3.js"></script>
<script src="js/part4.js"></script>
<script src="js/part5.js"></script>

<!-- Main Logic -->
<script>
    const STORAGE_KEY = 'agri_vantage_history_v1';
    
    let currentList = [];
    let currentIndex = 0;
    // historyState schema: { lastIndex: number, answers: { id: index }, bookmarks: [id, id] }
    let historyState = { lastIndex: 0, answers: {}, bookmarks: [] };
    
    // Changed default to -1 (A-) as requested for fresh load preference
    let fontLevel = -1; 
    let currentSearchTerm = '';
    let isBookmarkFilterActive = false; // State for bookmark filtering
    let isMistakesFilterActive = false; // State for mistakes filtering
    let isShuffleActive = false; // State for shuffle mode
    
    // NEW: Quick Mode Variables
    let isQuickModeActive = false;
    let quickSessionScore = 0;
    const QUICK_LIMIT = 10;

    // DOM Elements
    const cardArea = document.getElementById('cardArea');
    const quizContent = document.getElementById('quizContent');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressText = document.getElementById('progressText');
    const progressFill = document.getElementById('progressFill');
    const searchInput = document.getElementById('searchInput');
    const searchContainer = document.getElementById('searchContainer');
    const themeBtn = document.getElementById('themeBtn');
    const jumpTrigger = document.getElementById('jumpTrigger');
    const bookmarkFilterBtn = document.getElementById('bookmarkFilterBtn');
    const mistakeFilterBtn = document.getElementById('mistakeFilterBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const quickModeBtn = document.getElementById('quickModeBtn');
    const quizWidgetWrapper = document.getElementById('quizWidgetWrapper');

    window.onload = () => {
        // Set dynamic year for evergreen footer
        document.getElementById('currentYear').innerText = new Date().getFullYear();

        // Initialize Theme Icon
        const currentTheme = document.documentElement.getAttribute('data-theme');
        updateThemeIcon(currentTheme);

        // Wait 100ms for parts to load
        setTimeout(() => {
            if (window.quizData && window.quizData.length > 0) {
                // Ensure data is sorted by ID initially
                window.quizData.sort((a, b) => a.id - b.id);
                
                loadFromStorage();
                
                currentList = [...window.quizData];
                
                // DEEP LINK LOGIC: Check URL for ?id=XX
                const urlParams = new URLSearchParams(window.location.search);
                const sharedId = urlParams.get('id');
                
                if (sharedId) {
                    const qId = parseInt(sharedId);
                    const targetIndex = currentList.findIndex(q => q.id === qId);
                    
                    if (targetIndex !== -1) {
                        currentIndex = targetIndex;
                        // Scroll to widget to show shared content immediately
                        setTimeout(() => {
                            if(quizWidgetWrapper) quizWidgetWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 500);
                    }
                } else {
                    // Normal resumption
                    if (historyState.lastIndex && historyState.lastIndex < currentList.length) {
                        currentIndex = historyState.lastIndex;
                    }
                }
                
                loadQuestion(currentIndex);
                updateStats(); // Init stats
            } else {
                cardArea.innerHTML = `<div style="text-align:center; color:#EF4444; padding:20px; font-size:0.9rem;">
                    <strong>Data Missing</strong><br>
                    Please create <code>js/part1.js</code> to start.
                </div>`;
            }
        }, 100);
    };

    function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
        updateThemeIcon(next);
    }

    function updateThemeIcon(theme) {
        if(theme === 'dark') {
            themeBtn.innerHTML = '<i class="fa-solid fa-sun"></i>';
        } else {
            themeBtn.innerHTML = '<i class="fa-solid fa-moon"></i>';
        }
    }

    // Export Progress
    window.exportProgress = function() {
        const dataStr = JSON.stringify(historyState);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'agriquiz_backup.json';
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    // Import Progress
    window.importProgress = function(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const contents = JSON.parse(e.target.result);
                if (contents && contents.answers) {
                    historyState = contents;
                    // Backward compatibility for bookmarks
                    if(!historyState.bookmarks) historyState.bookmarks = [];
                    saveToStorage();
                    
                    // Reset to last index in imported data
                    if(historyState.lastIndex && historyState.lastIndex < currentList.length) {
                        currentIndex = historyState.lastIndex;
                    } else {
                        currentIndex = 0;
                    }
                    
                    applyFilters(); // Re-apply filters
                    updateStats();
                    alert('Progress restored successfully!');
                } else {
                    alert('Invalid backup file. Please ensure it is a valid AgriQuiz JSON file.');
                }
            } catch(err) {
                alert('Error reading file. Please try again.');
            }
        };
        reader.readAsText(file);
        // Reset input so same file can be selected again if needed
        input.value = '';
    }

    function adjustFont(dir) {
        fontLevel += dir;
        // Limit range
        if(fontLevel > 3) fontLevel = 3;
        if(fontLevel < -1) fontLevel = -1;
        loadQuestion(currentIndex);
    }

    function getFontSize() {
        // Optimized font size for mobile
        const isMobile = window.innerWidth <= 600;
        const baseSize = isMobile ? 0.75 : 0.9; // Smaller base on mobile (0.75rem approx 12px)
        const step = 0.1; 
        // Logic: fontLevel -1 (default) -> offset 0
        const offset = fontLevel + 1; 
        return `${baseSize + (offset * step)}rem`;
    }

    function updateStats() {
        const total = window.quizData.length;
        const completedIds = Object.keys(historyState.answers);
        const completedCount = completedIds.length;
        const leftCount = total - completedCount;
        
        let correctCount = 0;
        completedIds.forEach(id => {
            const q = window.quizData.find(item => item.id == id);
            if (q && q.answer === historyState.answers[id]) {
                correctCount++;
            }
        });
        
        const wrongCount = completedCount - correctCount;
        const accuracy = completedCount > 0 ? Math.round((correctCount / completedCount) * 100) : 0;

        document.getElementById('statDone').innerText = completedCount;
        document.getElementById('statLeft').innerText = leftCount;
        document.getElementById('statCorrect').innerText = correctCount;
        document.getElementById('statWrong').innerText = wrongCount;
        document.getElementById('statAccuracy').innerText = accuracy + '%';
    }

    // Highlighting Helper
    function highlightText(text, term) {
        if (!term || term.length < 2) return text;
        const safeTerm = term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const regex = new RegExp(`(${safeTerm})`, 'gi');
        return text.replace(regex, '<mark class="highlight">$1</mark>');
    }

    function loadQuestion(index) {
        quizContent.scrollTop = 0;

        // --- Quick Mode Completion Screen ---
        if (isQuickModeActive && index >= currentList.length) {
            // Show Summary
            cardArea.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-trophy" style="color:var(--accent)"></i>
                    <p style="font-size:1.1rem; font-weight:700;">Session Complete!</p>
                    <div class="summary-score">${quickSessionScore} / ${currentList.length}</div>
                    <p style="margin-bottom:20px; color:var(--text-sec)">Questions mastered in this quick session.</p>
                    <button class="summary-btn" onclick="continueQuickMode()">Start Next 10 <i class="fa-solid fa-arrow-right"></i></button>
                    <br><br>
                    <button style="background:transparent; color:var(--text-sec); font-size:0.8rem;" onclick="toggleQuickMode(false)">Exit Quick Mode</button>
                </div>
            `;
            updateControls(); // Will disable next/prev
            return;
        }

        if (!currentList || currentList.length === 0) {
            let message = '';
            let subMsg = '';
            
            if (isQuickModeActive) {
                message = `All caught up!`;
                subMsg = `You have answered all available questions. Try reviewing your mistakes.`;
            } else if (isMistakesFilterActive) {
                message = `Great job! No mistakes found.`;
                subMsg = `<span style="font-size:0.8em; color:var(--text-sec)">Any questions you answer incorrectly will appear here for review.</span>`;
            } else if (isBookmarkFilterActive) {
                message = `No bookmarks found.`;
                subMsg = `<span style="font-size:0.8em; color:var(--text-sec)">Tap the <i class="fa-regular fa-bookmark"></i> icon on any question to save it here.</span>`;
            } else {
                message = `No matches found for "<strong>${currentSearchTerm}</strong>"`;
            }

            cardArea.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-file-circle-question"></i>
                    <p>${message}</p>
                    ${subMsg ? `<p>${subMsg}</p>` : ''}
                    ${currentSearchTerm ? '<button onclick="clearSearch()">Clear Search</button>' : ''}
                    ${isQuickModeActive ? '<br><button onclick="toggleQuickMode(false)">Exit Quick Mode</button>' : ''}
                </div>`;
            updateControls();
            return;
        }

        const q = currentList[index];
        const savedAnswer = historyState.answers[q.id];
        const isAnswered = (savedAnswer !== undefined && savedAnswer !== null && typeof savedAnswer === 'number');
        const isBookmarked = historyState.bookmarks.includes(q.id);
        
        const fontSize = getFontSize();
        const qEnText = highlightText(q.questionEn, currentSearchTerm);
        const qHiText = highlightText(q.questionHi, currentSearchTerm);

        const optionsHtml = q.options.map((opt, i) => {
            let statusClass = '';
            let iconHtml = '';
            
            const optText = highlightText(opt, currentSearchTerm);
            
            if (isAnswered) {
                if (i === q.answer) { 
                    statusClass = 'correct'; 
                    iconHtml = '<span class="status-icon"><i class="fa-solid fa-check"></i></span>'; 
                } 
                else if (i === savedAnswer) { 
                    statusClass = 'wrong'; 
                    iconHtml = '<span class="status-icon"><i class="fa-solid fa-xmark"></i></span>'; 
                }
            }
            
            return `
            <div class="option-btn ${statusClass} ${isAnswered ? 'disabled' : ''}" 
                 style="font-size: ${fontSize};"
                 onclick="handleAnswer(this, '${q.id}', ${i})">
                <span>${optText}</span>
                ${iconHtml}
            </div>`;
        }).join('');

        let feedbackHtml = '';
        if (isAnswered) {
            const isCorrect = savedAnswer === q.answer;
            const bg = isCorrect ? 'var(--correct-bg)' : 'var(--wrong-bg)';
            const color = isCorrect ? 'var(--correct-text)' : 'var(--wrong-text)';
            const text = isCorrect ? 'Correct Answer!' : `Correct: ${q.options[q.answer]}`;
            feedbackHtml = `<div class="feedback-msg" style="display:block; background:${bg}; color:${color}">${text}</div>`;
        }

        const listClass = isAnswered ? 'options-list answered' : 'options-list';
        const statusDisplay = isAnswered 
            ? (savedAnswer === q.answer 
                ? '<i class="fa-solid fa-check"></i> Solved' 
                : '<i class="fa-solid fa-xmark"></i> Review') 
            : 'Pending';

        const bookmarkIconClass = isBookmarked ? 'fa-solid fa-bookmark active' : 'fa-regular fa-bookmark';

        cardArea.innerHTML = `
            <div class="q-meta">
                <span>Q. ${q.id}</span>
                <span class="q-actions">
                    <span style="color:var(--primary)">${statusDisplay}</span>
                    <i class="fa-solid fa-share-from-square share-icon" onclick="shareQuestion('${q.id}')" title="Share Question"></i>
                    <i class="${bookmarkIconClass} bookmark-icon" onclick="toggleBookmark('${q.id}')" title="Bookmark Question"></i>
                </span>
            </div>
            <div class="q-text-en" style="font-size:${fontSize}">${qEnText}</div>
            <div class="q-text-hi" style="font-size:${fontSize}">${qHiText}</div>
            <div class="${listClass}" id="opts-${q.id}">
                ${optionsHtml}
            </div>
            ${feedbackHtml}
        `;

        if (searchInput.value === '' && !isBookmarkFilterActive && !isMistakesFilterActive && !isShuffleActive && !isQuickModeActive) { 
            historyState.lastIndex = currentIndex;
            saveToStorage();
        }

        updateControls();
    }

    // Toggle Functions
    window.toggleBookmark = function(qId) {
        qId = parseInt(qId);
        const idx = historyState.bookmarks.indexOf(qId);
        if (idx > -1) historyState.bookmarks.splice(idx, 1);
        else historyState.bookmarks.push(qId);
        saveToStorage();
        loadQuestion(currentIndex); 
        if (isBookmarkFilterActive) applyFilters(false);
    };

    window.toggleBookmarkFilter = function() {
        isBookmarkFilterActive = !isBookmarkFilterActive;
        if (isBookmarkFilterActive) {
            disableOtherFilters('bookmark');
            document.getElementById('bookmarkFilterBtn').classList.add('active');
            document.getElementById('bookmarkFilterBtn').innerHTML = '<i class="fa-solid fa-bookmark"></i>';
        } else {
            document.getElementById('bookmarkFilterBtn').classList.remove('active');
            document.getElementById('bookmarkFilterBtn').innerHTML = '<i class="fa-regular fa-bookmark"></i>';
        }
        applyFilters(true);
    };

    window.toggleMistakeFilter = function() {
        isMistakesFilterActive = !isMistakesFilterActive;
        if (isMistakesFilterActive) {
            disableOtherFilters('mistake');
            document.getElementById('mistakeFilterBtn').classList.add('active');
        } else {
            document.getElementById('mistakeFilterBtn').classList.remove('active');
        }
        applyFilters(true);
    }

    window.toggleShuffle = function() {
        isShuffleActive = !isShuffleActive;
        if (isShuffleActive) {
            document.getElementById('shuffleBtn').classList.add('active');
        } else {
            document.getElementById('shuffleBtn').classList.remove('active');
        }
        applyFilters(true);
    }

    // NEW: Quick Mode Logic
    window.toggleQuickMode = function(forceOn = null) {
        if (forceOn !== null) isQuickModeActive = forceOn;
        else isQuickModeActive = !isQuickModeActive;

        if (isQuickModeActive) {
            // Scroll to widget if coming from hero
            quizWidgetWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            disableOtherFilters('quick');
            document.getElementById('quickModeBtn').classList.add('active');
            // Reset score for new session
            quickSessionScore = 0;
        } else {
            document.getElementById('quickModeBtn').classList.remove('active');
        }
        applyFilters(true);
    };

    window.continueQuickMode = function() {
        // Just re-run filter logic, it will pick up next 10 because previous 10 are now answered
        // Reset score for next batch
        quickSessionScore = 0;
        applyFilters(true);
    }

    function disableOtherFilters(active) {
        if (active !== 'bookmark') {
            isBookmarkFilterActive = false;
            document.getElementById('bookmarkFilterBtn').classList.remove('active');
            document.getElementById('bookmarkFilterBtn').innerHTML = '<i class="fa-regular fa-bookmark"></i>';
        }
        if (active !== 'mistake') {
            isMistakesFilterActive = false;
            document.getElementById('mistakeFilterBtn').classList.remove('active');
        }
        if (active !== 'quick') {
            isQuickModeActive = false;
            document.getElementById('quickModeBtn').classList.remove('active');
        }
    }

    function applyFilters(resetIndex = false) {
        const term = currentSearchTerm;
        let filtered = [...window.quizData];

        // 1. Shuffle
        if (isShuffleActive) {
            // Seeded shuffle? No, random for now.
            for (let i = filtered.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [filtered[i], filtered[j]] = [filtered[j], filtered[i]];
            }
        } else {
            filtered.sort((a, b) => a.id - b.id);
        }

        // 2. Pre-filters
        if (isBookmarkFilterActive) {
            filtered = filtered.filter(q => historyState.bookmarks.includes(q.id));
        } else if (isMistakesFilterActive) {
            filtered = filtered.filter(q => {
                const userAns = historyState.answers[q.id];
                return userAns !== undefined && userAns !== q.answer;
            });
        }

        // 3. Search
        if (term && term !== '') {
             filtered = filtered.filter(q => {
                const qEn = q.questionEn ? q.questionEn.toLowerCase() : '';
                const qHi = q.questionHi ? q.questionHi.toLowerCase() : ''; 
                const qId = q.id ? q.id.toString() : '';
                const optionsStr = q.options ? q.options.join(' ').toLowerCase() : '';
                return qEn.includes(term) || qHi.includes(term) || qId.includes(term) || optionsStr.includes(term);
            });
        }

        // 4. Quick Mode (MUST BE LAST to slice results)
        if (isQuickModeActive) {
            // Filter to only Unanswered questions
            filtered = filtered.filter(q => historyState.answers[q.id] === undefined);
            // Slice the first 10
            filtered = filtered.slice(0, QUICK_LIMIT);
        }

        currentList = filtered;
        
        if (resetIndex) {
            currentIndex = 0;
        } else {
            if (currentIndex >= currentList.length) {
                // If filtered list shrank and index is out of bounds, go to last valid
                currentIndex = Math.max(0, currentList.length - 1);
                // Or simply 0 to be safe
                if (currentIndex < 0) currentIndex = 0; 
            }
        }
        
        loadQuestion(currentIndex);
    }

    // Share Question Logic
    window.shareQuestion = async function(qId) {
        const q = window.quizData.find(item => item.id == qId);
        if(!q) return;
        
        // Base URL
        const baseUrl = window.location.origin + window.location.pathname;
        const deepLink = `${baseUrl}?id=${qId}`;
        
        // Construct message
        const shareText = `Can you solve this AgriQuiz question? \n\nQ: ${q.questionEn}\n\n Attempt here: ${deepLink}`;
        
        // Try Web Share API first (Mobile)
        if (navigator.share) {
            try {
                await navigator.share({
                    title: 'AgriQuiz Challenge',
                    text: shareText,
                    url: deepLink
                });
            } catch (err) {
                // If canceled, fallback to clipboard
            }
        } else {
            // Fallback for Desktop: Copy to Clipboard
            try {
                await navigator.clipboard.writeText(shareText);
                alert('Challenge link copied to clipboard!');
            } catch (err) {
                alert('Could not copy link.');
            }
        }
    };

    window.handleAnswer = function(btn, qId, choiceIndex) {
        if (!currentList || !currentList[currentIndex]) return;
        
        const q = currentList[currentIndex];
        
        // Track score for Quick Mode (only on first attempt)
        if (isQuickModeActive && historyState.answers[qId] === undefined) {
            if (choiceIndex === q.answer) quickSessionScore++;
        }

        historyState.answers[qId] = choiceIndex;
        saveToStorage();
        updateStats(); 
        loadQuestion(currentIndex);
    };

    nextBtn.addEventListener('click', () => {
        // In Quick Mode, allow going past the last question to show summary
        if (isQuickModeActive && currentIndex === currentList.length - 1) {
            currentIndex++;
            loadQuestion(currentIndex);
        } else if (currentIndex < currentList.length - 1) {
            currentIndex++;
            loadQuestion(currentIndex);
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            loadQuestion(currentIndex);
        }
    });

    jumpTrigger.addEventListener('click', () => {
        if (isQuickModeActive) return; // Disable manual jump in quick mode for focus
        const max = currentList.length;
        if (max === 0) return;
        let msg = `Enter Card Number (1 - ${max}) to jump:`;
        if (isShuffleActive) msg += `\n(Note: In Shuffle mode, this jumps to the position in the random list, not Question ID)`;
        const p = prompt(msg, currentIndex + 1);
        if (p) {
            const num = parseInt(p);
            if (!isNaN(num) && num >= 1 && num <= max) {
                currentIndex = num - 1;
                loadQuestion(currentIndex);
            }
        }
    });

    document.addEventListener('keydown', (e) => {
        if (document.activeElement !== searchInput) {
            if (e.key === 'ArrowRight' && !nextBtn.disabled) nextBtn.click();
            if (e.key === 'ArrowLeft' && !prevBtn.disabled) prevBtn.click();
        }
    });

    function updateControls() {
        // Special case for Quick Mode Summary Screen
        if (isQuickModeActive && currentIndex >= currentList.length) {
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            progressText.innerText = "Done";
            progressFill.style.width = "100%";
            return;
        }

        if (!currentList || currentList.length === 0) {
            prevBtn.disabled = true;
            nextBtn.disabled = true;
            progressText.innerText = `0 / 0`;
            progressFill.style.width = `0%`;
            return;
        }

        const currentQ = currentList[currentIndex];
        const isAnswered = historyState.answers[currentQ.id] !== undefined;

        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = (currentIndex === currentList.length - 1 && !isQuickModeActive) || (!isAnswered); 
        // In Quick Mode, Next is enabled on last question if answered, to go to summary

        let label = `${currentIndex + 1} / ${currentList.length}`;
        let prefix = [];
        
        if (isQuickModeActive) prefix.push("Quick 10");
        else if (isShuffleActive) prefix.push("Random");
        
        if (isMistakesFilterActive) prefix.push("Mistakes");
        else if (isBookmarkFilterActive) prefix.push("Saved");
        else if (currentSearchTerm) prefix.push("Found");
        
        if (prefix.length > 0) label = `${prefix.join(' + ')}: ${label}`;

        progressText.innerText = label;
        const pct = ((currentIndex + 1) / currentList.length) * 100;
        progressFill.style.width = `${pct}%`;
    }

    // Enhanced Search Logic
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase().trim();
        currentSearchTerm = term;
        // Toggle Clear Button
        if (term.length > 0) searchContainer.classList.add('active');
        else searchContainer.classList.remove('active');
        applyFilters(true);
    });

    window.clearSearch = function() {
        searchInput.value = '';
        searchInput.dispatchEvent(new Event('input')); 
        searchInput.focus();
    };
    
    // Share Logic
    window.shareApp = async function() {
        const canonical = document.querySelector('link[rel="canonical"]')?.href || window.location.href;
        const btn = document.querySelector('.footer-share-btn');
        const originalHtml = btn.innerHTML;
        if (navigator.share) {
            try { await navigator.share({ url: canonical }); } catch (err) {}
        } else {
            try {
                await navigator.clipboard.writeText(canonical);
                btn.innerHTML = '<i class="fa-solid fa-check"></i> Copied!';
                setTimeout(() => { btn.innerHTML = originalHtml; }, 2000);
            } catch (err) {}
        }
    };

    function saveToStorage() { localStorage.setItem(STORAGE_KEY, JSON.stringify(historyState)); }
    function loadFromStorage() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) { 
            try { 
                historyState = JSON.parse(saved); 
                if (!historyState.answers) historyState.answers = {}; 
                if (!historyState.bookmarks) historyState.bookmarks = []; 
            } catch (e) {} 
        }
    }
    window.resetProgress = function() {
        if(confirm("Clear history?")) { localStorage.removeItem(STORAGE_KEY); location.reload(); }
    };
</script>
</body>
</html>
